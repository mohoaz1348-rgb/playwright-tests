# UI тесты веб-сайта

Это проект, который демонстрирует использование python, playwright, pytest, allure для написания UI-тестов. Для запуска тестов используется GitHub Actions. При запуске происходит подготовка окружения для запуска тестов с помощью uv, запуск тестов, генерация отчета Allure (на основе истории предыдущих прогонов и файла executor.json) и выкладывание итогового отчета на gh-pages данного репозитория. Полученный отчет доступен по ссылке - https://mohoaz1348-rgb.github.io/playwright-tests/index.html.

## Pytest служит для организации и запуска тестов.

В проекте показано использование слeдующих возможностей pytest:

- метки для запуска только определенных тестов
- метки для повторного запуска тестов
- фикстуры для подготовки окружения тестов (запуск браузера с записью видео и трейса playwright, чтение настроек проекта из файла .env)
- параметризация тестов
- параметризация фикстур, которые используются в тестах
- динамическая параметризация фикстур на основе параметров командной строки pytest
- создание новых параметров командной строки pytest

## Playwright:

- запуск браузера с записью видео и трейса playwright, навигация в браузере
- нахождение элемента страницы по его локатору, взаимодействие с этим элементом
- ожидания и проверки состояния элемента страницы

## Allure:

- создание отчета о прогоне тестов
- добавление видео и трейса в отчет
- добавление шагов в отчет
- добавление записи в лог, который прикладывается к отчету
- создание отчета о прогоне тестов на основе истории прошлых запусков и файла executor.json

## pydantic, pydantic-settings

- чтение настроек проекта из файла .env и их проверка

## Управление проектом

Для хранения настроек проекта используется pyproject.toml, в котором хранятся настройки pytest и зависимости проекта. Если надо добавить какую-нибудь зависимость для проекта, то для этого использую команду uv add. Например uv add pytest установит pytest и добавит зависимость pytest в файл pyproject.toml.
Для фиксации версии python используется файл .python-version в корне проекта. Этот файл создается с помощью команды `uv python pin 3.12`

## Запуск тестов на локальной машине

После клонирования репозитория и установке uv, выполните команды:

`uv python install`         
`uv sync --frozen`          # Ставим библиотеки строго по лок-файлу, эта команда автоматически настроит виртуальное окружение  
`uv run playwright install --with-deps` # Заходить в виртуальное окружение не надо, т.к. используется uv run

Для запуска тестов на локальной машине используется `run.py`, который лежит в корне проекта. Этот скрипт производит очистку прошлых результатов тестов, осуществляет проброс переданных ему параметров в pytest и запускает allure serve после прохождения тестов. Полученный отчет открывается в браузере.

Пример, использования run.py:

`uv run python run.py -m debug`   # Запуск всех тестов помеченных как debug  
Т.к. браузер не указан, то по умолчанию используется Chrimium, который запустится в headless режиме. Настройка режима берётся из файла .env.

`uv run python run.py -m debug --browsers chromium,firefox`  
`uv run python run.py -m debug --browsers all`  
browsers - это кастомный флаг pytest, который создается в conftest.py

`uv run python run.py -m debug --no-serve`   # Не запускать построение Allure-отчета






